<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CMA FOUNDATION | MICRO-INTEL UNIT</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Rajdhani:wght@300;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --neon-blue: #00d2ff; --neon-green: #00ff9f; --neon-purple: #9d50bb; --neon-orange: #ff9f00;
            --bg-dark: #050505; --card-bg: rgba(15, 15, 20, 0.95); --border: 1px solid rgba(0, 210, 255, 0.2);
        }
        * { box-sizing: border-box; transition: 0.2s ease; }
        body { background: var(--bg-dark); color: #fff; font-family: 'Rajdhani', sans-serif; margin: 0; overflow: hidden; }
        #login-screen { position: fixed; inset: 0; z-index: 1000; display: flex; justify-content: center; align-items: center; background: #000; }
        .auth-card { background: var(--card-bg); padding: 40px; border: var(--border); border-radius: 15px; text-align: center; }
        input[type="password"] { background: transparent; border: none; border-bottom: 2px solid var(--neon-blue); color: var(--neon-blue); font-family: 'Orbitron'; font-size: 1.2rem; padding: 10px; width: 280px; text-align: center; outline: none; }
        #main-terminal { display: none; height: 100vh; grid-template-columns: 260px 1fr; }
        .sidebar { background: #0a0a0c; border-right: var(--border); padding: 20px; display: flex; flex-direction: column; }
        .nav-link { padding: 12px; margin-bottom: 8px; border-radius: 5px; cursor: pointer; border: 1px solid transparent; font-size: 0.9rem; }
        .nav-link:hover { background: rgba(0, 210, 255, 0.1); }
        .nav-link.active { background: var(--neon-blue); color: #000; font-weight: bold; }
        .content { overflow-y: auto; padding: 40px; background: rgba(0,0,0,0.4); }
        .rank-box { background: #111; padding: 20px; border-radius: 10px; margin-bottom: 15px; border-left: 4px solid var(--neon-blue); cursor: pointer; }
        .detail-view { display: none; padding: 20px; background: rgba(0,0,0,0.5); margin-top: 10px; align-items: center; justify-content: center; gap: 40px; }
        .multi-pie { width: 120px; height: 120px; border-radius: 50%; position: relative; display: flex; align-items: center; justify-content: center; background: #222; }
        .multi-pie::after { content: ""; position: absolute; width: 85px; height: 85px; background: #111; border-radius: 50%; z-index: 2; }
        .pie-text { position: relative; z-index: 3; font-family: 'Orbitron'; font-size: 1.2rem; }
        .pie-legend { text-align: left; font-size: 0.8rem; font-family: 'Orbitron'; }
        .legend-item { display: flex; align-items: center; gap: 8px; margin-bottom: 4px; }
        .dot { width: 8px; height: 8px; border-radius: 50%; }
        .chapter-block { background: var(--card-bg); border: var(--border); border-radius: 10px; margin-bottom: 25px; overflow: hidden; }
        .chapter-header { background: rgba(0, 210, 255, 0.05); padding: 15px; border-bottom: 1px solid rgba(255,255,255,0.05); display: flex; justify-content: space-between; align-items: center; }
        .topic-list { padding: 10px 20px; }
        .topic-item { display: flex; align-items: center; padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,0.02); font-size: 0.95rem; opacity: 0.8; }
        input[type="checkbox"] { appearance: none; width: 16px; height: 16px; border: 1px solid var(--neon-blue); border-radius: 3px; margin-right: 12px; cursor: pointer; position: relative; }
        input[type="checkbox"]:checked { background: var(--neon-blue); }
        input[type="checkbox"]:checked::after { content: 'âœ“'; position: absolute; left: 3px; top: -2px; color: #000; font-size: 12px; font-weight: bold; }
        .tag { font-size: 10px; padding: 2px 6px; border-radius: 3px; background: #222; margin-left: 10px; }
    </style>
</head>
<body>
    <div id="login-screen">
        <div class="auth-card">
            <h1 style="font-family:'Orbitron'; color:var(--neon-blue); letter-spacing:3px;">IDENTITY CHECK</h1>
            <input type="password" id="passCode" placeholder="ENTER ACCESS KEY..." onkeydown="if(event.key==='Enter') verify()">
        </div>
    </div>
    <div id="main-terminal">
        <aside class="sidebar">
            <div style="margin-bottom:30px; border-bottom:1px solid #222; padding-bottom:15px;">
                <div id="agent-name" style="font-family:'Orbitron'; color:var(--neon-green); font-size:1.1rem;">---</div>
                <div id="overall-prog" style="color:var(--neon-blue); font-size:0.8rem; margin-top:5px;">MISSION: 0%</div>
            </div>
            <nav id="sidebar-nav">
                <div class="nav-link active" onclick="showView('home')">SQUAD HUB</div>
                <div class="nav-link" onclick="showView('p1')">P1: LAWS & COMM</div>
                <div class="nav-link" onclick="showView('p2')">P2: ACCOUNTS & COST</div>
                <div class="nav-link" onclick="showView('p3')">P3: MATH & STATS</div>
                <div class="nav-link" onclick="showView('p4')">P4: ECON & MGMT</div>
            </nav>
            <button onclick="location.reload()" style="margin-top:auto; background:none; border:1px solid #333; color:#666; padding:8px; cursor:pointer;">EXIT SYSTEM</button>
        </aside>
        <main class="content" id="viewport"></main>
    </div>

    <script>
        const API_URL = "https://sheetdb.io/api/v1/ovw2jw6xa21bm";
        const AGENTS = { "singhtanay": "Tanay Singh", "murmurprem": "Prem Murmur", "rajyash": "Yash Raj" };
        const MICRO_SYLLABUS = {
            p1: { title: "Paper 1: Business Laws & Communication", chapters: [
                { name: "Indian Contract Act, 1872", topics: ["Offer & Acceptance", "Consideration", "Capacity of Parties", "Free Consent", "Legality of Object", "Performance & Discharge"] },
                { name: "Sale of Goods Act, 1930", topics: ["Formation of Contract", "Conditions & Warranties", "Transfer of Ownership", "Rights of Unpaid Seller"] },
                { name: "Business Communication", topics: ["Process of Communication", "Types (Verbal/Non-Verbal)", "Barriers", "Modern Tools"] }
            ]},
            p2: { title: "Paper 2: Financial & Cost Accounting", chapters: [
                { name: "Accounting Fundamentals", topics: ["GAAP Principles", "Journal & Ledger", "Trial Balance", "BRS", "Depreciation"] },
                { name: "Special Transactions", topics: ["Consignment Accounts", "Joint Venture", "Bills of Exchange"] },
                { name: "Cost Accounting", topics: ["Basic Concepts", "Cost Sheet", "Material & Labour Cost"] }
            ]},
            p3: { title: "Paper 3: Math & Statistics", chapters: [
                { name: "Business Mathematics", topics: ["Ratio & Proportion", "Simple/Compound Interest", "AP & GP", "Sets & Indices", "Calculus Basics"] },
                { name: "Business Statistics", topics: ["Data Representation", "Central Tendency", "Standard Deviation", "Probability", "Index Numbers"] }
            ]},
            p4: { title: "Paper 4: Economics & Management", chapters: [
                { name: "Economics", topics: ["Demand & Supply", "Market Forms", "Money & Banking", "PESTEL Analysis"] },
                { name: "Management", topics: ["Management Process", "Planning & Decision Making", "Organizing & Staffing", "Leadership & Motivation"] }
            ]}
        };

        let activeAgent = "";
        let db = { "Tanay Singh": {}, "Prem Murmur": {}, "Yash Raj": {} };

        async function verify() {
            const val = document.getElementById('passCode').value;
            if (AGENTS[val]) {
                activeAgent = AGENTS[val];
                await fetchCloudData();
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('main-terminal').style.display = 'grid';
                document.getElementById('agent-name').innerText = activeAgent;
                showView('home');
            }
        }

        async function fetchCloudData() {
            try {
                const response = await fetch(API_URL);
                const data = await response.json();
                data.forEach(row => {
                    if (row.progress_data && row.progress_data !== "{}") db[row.agent_name] = JSON.parse(row.progress_data);
                });
            } catch (e) { console.error("Sync Error", e); }
        }

        async function toggleTopic(key) {
            db[activeAgent][key] = !db[activeAgent][key];
            document.getElementById('overall-prog').innerText = "MISSION: " + getOverall(activeAgent) + "%";
            await fetch(`${API_URL}/agent_name/${activeAgent}`, {
                method: 'PATCH',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ "progress_data": JSON.stringify(db[activeAgent]) })
            });
        }

        function getProgress(name, paperKey) {
            let total = 0, done = 0;
            MICRO_SYLLABUS[paperKey].chapters.forEach(ch => {
                ch.topics.forEach(t => { total++; if (db[name][paperKey + ch.name + t]) done++; });
            });
            return (done / total) * 100 || 0;
        }

        function getOverall(name) {
            return Math.round((['p1','p2','p3','p4'].reduce((acc, p) => acc + getProgress(name, p), 0)) / 4);
        }

        function showView(vid) {
            const vp = document.getElementById('viewport');
            vp.innerHTML = "";
            document.querySelectorAll('.nav-link').forEach(n => n.classList.remove('active'));
            if (vid === 'home') {
                vp.innerHTML = `<h1 style="font-family:'Orbitron'">SQUAD INTELLIGENCE HUB</h1>`;
                Object.values(AGENTS).forEach(name => {
                    const p1 = getProgress(name, 'p1'), p2 = getProgress(name, 'p2'), p3 = getProgress(name, 'p3'), p4 = getProgress(name, 'p4');
                    const over = Math.round((p1 + p2 + p3 + p4) / 4);
                    const safeId = name.replace(/\s/g, '');
                    const s1 = p1 * 0.25, s2 = p2 * 0.25, s3 = p3 * 0.25, s4 = p4 * 0.25;
                    vp.innerHTML += `
                        <div class="rank-box" onclick="const d=document.getElementById('det-${safeId}'); d.style.display=(d.style.display==='flex'?'none':'flex')">
                            <div style="display:flex; justify-content:space-between; margin-bottom:5px;"><span>AGENT: ${name}</span><span style="color:var(--neon-green)">${over}%</span></div>
                            <div style="height:6px; background:#222; border-radius:3px; overflow:hidden;"><div style="width:${over}%; height:100%; background:linear-gradient(90deg, var(--neon-blue), var(--neon-purple))"></div></div>
                            <div class="detail-view" id="det-${safeId}">
                                <div class="multi-pie" style="background: conic-gradient(var(--neon-blue) 0% ${s1}%, #222 ${s1}% 25%, var(--neon-purple) 25% ${25+s2}%, #222 ${25+s2}% 50%, var(--neon-green) 50% ${50+s3}%, #222 ${50+s3}% 75%, var(--neon-orange) 75% ${75+s4}%, #222 ${75+s4}% 100%)">
                                    <span class="pie-text">${over}%</span>
                                </div>
                                <div class="pie-legend">
                                    <div class="legend-item"><div class="dot" style="background:var(--neon-blue)"></div> P1: ${Math.round(p1)}%</div>
                                    <div class="legend-item"><div class="dot" style="background:var(--neon-purple)"></div> P2: ${Math.round(p2)}%</div>
                                    <div class="legend-item"><div class="dot" style="background:var(--neon-green)"></div> P3: ${Math.round(p3)}%</div>
                                    <div class="legend-item"><div class="dot" style="background:var(--neon-orange)"></div> P4: ${Math.round(p4)}%</div>
                                </div>
                            </div>
                        </div>`;
                });
            } else {
                const data = MICRO_SYLLABUS[vid];
                vp.innerHTML = `<h1 style="color:var(--neon-blue)">${data.title}</h1>`;
                data.chapters.forEach(ch => {
                    let chHtml = `<div class="chapter-block"><div class="chapter-header"><span style="font-weight:bold; font-family:'Orbitron'">${ch.name}</span><span class="tag">${ch.topics.length} TARGETS</span></div><div class="topic-list">`;
                    ch.topics.forEach(t => {
                        const key = vid + ch.name + t;
                        const checked = db[activeAgent][key] ? 'checked' : '';
                        chHtml += `<div class="topic-item"><input type="checkbox" onchange="toggleTopic('${key}')" ${checked}><span>${t}</span></div>`;
                    });
                    vp.innerHTML += chHtml + `</div></div>`;
                });
            }
        }
    </script>
</body>
</html>