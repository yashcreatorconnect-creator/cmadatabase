<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CMA FOUNDATION | SQUAD INTEL PRO</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Rajdhani:wght@300;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --p1-red: #ff0000; --p2-orange: #ff8c00; --p3-cyan: #00ffff; --p4-purple: #9d50bb;
            --section-yellow: #ffff00; --ch-green: #39ff14; --topic-white: #ffffff;
            --bg-dark: #050505; --card-bg: rgba(15, 15, 20, 0.95);
        }
        * { box-sizing: border-box; transition: 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg-dark); color: var(--topic-white); font-family: 'Rajdhani', sans-serif; margin: 0; overflow: hidden; touch-action: manipulation; display: flex; flex-direction: column; height: 100vh; }
        
        #login-screen { position: fixed; inset: 0; z-index: 1000; display: flex; justify-content: center; align-items: center; background: radial-gradient(circle, #1a0000 0%, #000 100%); }
        .auth-card { background: var(--card-bg); padding: 30px; border: 1px solid var(--p1-red); border-radius: 20px; text-align: center; width: 90%; max-width: 400px; box-shadow: 0 0 30px rgba(255, 0, 0, 0.2); }
        input[type="password"] { background: transparent; border: none; border-bottom: 2px solid var(--p1-red); color: var(--p1-red); font-family: 'Orbitron'; font-size: 1.2rem; padding: 10px; width: 100%; text-align: center; outline: none; }

        #main-terminal { display: none; flex: 1; grid-template-columns: 1fr; overflow: hidden; }
        @media (min-width: 768px) { #main-terminal { grid-template-columns: 280px 1fr; } }

        .sidebar { background: #0a0a0c; border-right: 1px solid rgba(255,255,255,0.05); padding: 20px; display: flex; flex-direction: column; overflow-y: auto; }
        @media (max-width: 767px) { 
            .sidebar { height: auto; border-right: none; border-bottom: 1px solid #333; padding: 15px; }
            #main-terminal { grid-template-rows: auto 1fr; height: auto; }
            .nav-container { display: flex; overflow-x: auto; gap: 10px; padding-bottom: 5px; scrollbar-width: none; }
            .nav-link { min-width: 140px; margin-bottom: 0 !important; font-size: 0.7rem !important; }
        }

        .nav-link { padding: 12px; margin-bottom: 8px; border-radius: 8px; cursor: pointer; font-family: 'Orbitron'; font-size: 0.8rem; border-left: 4px solid transparent; opacity: 0.6; }
        .nav-link.active { border-left-color: var(--p3-cyan); background: rgba(0, 255, 255, 0.1); opacity: 1; }

        .content { overflow-y: auto; padding: 20px; -webkit-overflow-scrolling: touch; flex: 1; }
        
        .chart-container { background: rgba(255,255,255,0.02); border: 1px solid #222; border-radius: 15px; padding: 20px; margin-bottom: 30px; position: relative; height: 250px; display: flex; align-items: flex-end; justify-content: space-around; }
        .y-axis { position: absolute; left: 10px; height: 75%; border-left: 1px solid #444; display: flex; flex-direction: column; justify-content: space-between; font-size: 0.6rem; color: #666; padding-left: 5px; }
        .bar-wrapper { display: flex; flex-direction: column; align-items: center; width: 25%; position: relative; z-index: 5; }
        .bar-pillar { width: 30px; background: linear-gradient(0deg, #111 0%, var(--ch-green) 100%); border-radius: 4px 4px 0 0; min-height: 2px; transition: height 1s ease; }
        .bar-val { font-family: 'Orbitron'; font-size: 0.7rem; margin-bottom: 5px; color: var(--ch-green); }
        .bar-label { font-family: 'Orbitron'; font-size: 0.6rem; margin-top: 10px; color: #888; text-align: center; }

        /* Scrollable Pie Chart System */
        .pie-scroll-container { display: flex; overflow-x: auto; gap: 20px; padding: 20px 0; scrollbar-width: none; margin-bottom: 30px; border-bottom: 1px solid #222; }
        .pie-card { flex: 0 0 auto; display: flex; flex-direction: column; align-items: center; width: 120px; }
        .multi-pie { width: 80px; height: 80px; border-radius: 50%; position: relative; display: flex; align-items: center; justify-content: center; }
        .multi-pie::after { content: ""; position: absolute; width: 60px; height: 60px; background: #050505; border-radius: 50%; z-index: 2; }
        .pie-val { position: relative; z-index: 3; font-family: 'Orbitron'; font-size: 0.8rem; color: #fff; }
        .pie-label { font-size: 0.7rem; margin-top: 10px; font-family: 'Orbitron'; opacity: 0.7; }

        .comp-item { background: rgba(255,255,255,0.02); padding: 12px; border-radius: 8px; border-left: 4px solid transparent; margin-bottom: 8px; }
        .comp-label { font-size: 0.6rem; font-family: 'Orbitron'; opacity: 0.5; margin-bottom: 4px; }
        .comp-bar-bg { height: 6px; background: #222; border-radius: 3px; overflow: hidden; }

        .rank-card { background: #111; padding: 15px; border-radius: 12px; margin-bottom: 12px; cursor: pointer; border: 1px solid #222; }
        .detail-view { display: none; flex-direction: column; padding: 10px; background: rgba(0,0,0,0.4); border-radius: 8px; margin-top: 10px; }
        
        .ch-card { background: rgba(255,255,255,0.02); border: 1px solid var(--ch-green); margin-bottom: 15px; border-radius: 10px; overflow: hidden; }
        .ch-head { padding: 12px 15px; background: rgba(57, 255, 20, 0.05); color: var(--ch-green); font-family: 'Orbitron'; font-size: 0.85rem; border-bottom: 1px solid #333; display: flex; justify-content: space-between; align-items: center; }
        .topic-row { padding: 10px 15px; display: flex; align-items: center; border-bottom: 1px solid #222; font-size: 0.9rem; }
        input[type="checkbox"] { width: 22px; height: 22px; margin-right: 15px; accent-color: var(--p3-cyan); flex-shrink: 0; cursor: pointer; }

        .upload-btn { background: var(--p3-cyan); color: #000; padding: 4px 8px; border-radius: 4px; font-size: 0.6rem; font-family: 'Orbitron'; cursor: pointer; display: none; font-weight: bold; border: none; }

        .footer { background: rgba(0, 0, 0, 0.9); border-top: 1px solid rgba(255, 255, 255, 0.05); padding: 10px; text-align: center; font-family: 'Orbitron', sans-serif; font-size: 0.65rem; letter-spacing: 2px; color: rgba(255, 255, 255, 0.4); text-transform: uppercase; width: 100%; }
        .footer span { color: var(--p3-cyan); text-shadow: 0 0 5px var(--p3-cyan); }
    </style>
</head>
<body>
    <div id="login-screen"><div class="auth-card"><h1 style="color:var(--p1-red); font-family:'Orbitron'; font-size: 1.2rem;">IDENTITY CHECK</h1><input type="password" id="passCode" placeholder="ACCESS KEY..." onkeydown="if(event.key==='Enter') verify()"></div></div>
    <div id="main-terminal">
        <aside class="sidebar">
            <div id="profile-area" style="margin-bottom:20px; border-bottom:1px solid #333; padding-bottom:15px;">
                <div id="agent-name" style="font-family:'Orbitron'; color:var(--ch-green); font-size: 1rem;">---</div>
                <div id="overall-prog" style="color:var(--p3-cyan); font-size:0.75rem; margin-top:5px; font-family:'Orbitron';">MISSION: 0%</div>
            </div>
            <nav id="sidebar-nav" class="nav-container">
                <div class="nav-link active" onclick="showView('home', this)">SQUAD HUB</div>
                <div class="nav-link" onclick="showView('p1', this)">P1: LAWS</div>
                <div class="nav-link" onclick="showView('p2', this)">P2: ACCOUNTS</div>
                <div class="nav-link" onclick="showView('p3', this)">P3: MATH</div>
                <div class="nav-link" onclick="showView('p4', this)">P4: ECON</div>
            </nav>
            <button onclick="location.reload()" style="margin-top:auto; background:none; border:1px solid #444; color:#666; padding:8px; border-radius:5px; cursor:pointer; font-size: 0.7rem;">LOGOUT</button>
        </aside>
        <main class="content" id="viewport"></main>
    </div>

    <footer class="footer">
        ALL RIGHTS ARE PRIVATE <span>Â© NOTZIE 2026</span>
    </footer>

    <script>
        const API_URL = "https://sheetdb.io/api/v1/oj0l2zb1m9qnd";
        const DRIVE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwB1dGM26Vsxo9hYoqZPyRJZ_7QY4fPOm4b-qrZKLfMT3QEoDVEmpbySlQMueOyGICqzw/exec";
        const AGENTS = { "singhtanay": "Tanay Singh", "murmuprem": "Prem Murmu", "rajyash": "Yash Raj" };
        const SYLLABUS = {
            p1: { title: "Paper 1", subName: "BUSINESS LAWS & COMMUNICATION", color: "var(--p1-red)", sections: [
                { name: "SECTION A: BUSINESS LAWS", chapters: [{ name: "Introduction to Law", topics: ["Sources of Law", "Legislative Process", "Court System"] }, { name: "Indian Contract Act, 1872", topics: ["Offer & Acceptance", "Consideration", "Capacity", "Consent", "Breach"] }, { name: "Sale of Goods Act, 1930", topics: ["Formation", "Ownership", "Unpaid Seller"] }, { name: "Negotiable Instruments", topics: ["Types", "Sec 138"] }]},
                { name: "SECTION B: COMMUNICATION", chapters: [{ name: "Comm Skills", topics: ["Principles", "Barriers", "Correspondence"] }]}
            ]},
            p2: { title: "Paper 2", subName: "FINANCIAL & COST ACCOUNTING", color: "var(--p2-orange)", sections: [
                { name: "SECTION A: FINANCIAL ACCOUNTS", chapters: [{ name: "Fundamentals", topics: ["GAAP", "Journal", "BRS", "Depreciation"] }, { name: "Special Transactions", topics: ["Consignment", "Joint Venture", "Bills"] }, { name: "Final Accounts", topics: ["Sole Prop", "NPO"] }]},
                { name: "SECTION B: COST ACCOUNTS", chapters: [{ name: "Costing Basics", topics: ["Classification", "Cost Sheet"] }]}
            ]},
            p3: { title: "Paper 3", subName: "MATH & STATISTICS", color: "var(--p3-cyan)", sections: [
                { name: "SECTION A: MATHEMATICS", chapters: [{ name: "Arithmetic", topics: ["Ratio", "Interest", "Progression"] }, { name: "Algebra", topics: ["Sets", "Permutations", "Quadratic"] }, { name: "Calculus", topics: ["Derivatives"] }]},
                { name: "SECTION B: STATISTICS", chapters: [{ name: "Representation", topics: ["Diagrams", "Central Tendency", "Dispersion"] }, { name: "Advanced", topics: ["Correlation", "Probability", "Time Series"] }]}
            ]},
            p4: { title: "Paper 4", subName: "ECONOMICS & MANAGEMENT", color: "var(--p4-purple)", sections: [
                { name: "SECTION A: ECONOMICS", chapters: [{ name: "Concepts", topics: ["Demand/Supply", "Production", "Cost"] }, { name: "Market/Banking", topics: ["Monopoly", "Money Functions", "PESTEL"] }]},
                { name: "SECTION B: MANAGEMENT", chapters: [{ name: "Process", topics: ["Planning", "Leading", "Decision Making", "Motivation"] }]}
            ]}
        };

        let activeAgent = "";
        let db = { "Tanay Singh": {}, "Prem Murmu": {}, "Yash Raj": {} };

        async function verify() {
            const val = document.getElementById('passCode').value;
            if (AGENTS[val]) { activeAgent = AGENTS[val]; await fetchCloudData(); document.getElementById('login-screen').style.display = 'none'; document.getElementById('main-terminal').style.display = 'grid'; document.getElementById('agent-name').innerText = activeAgent; showView('home', document.querySelector('.nav-link')); }
        }

        async function fetchCloudData() {
            try { const res = await fetch(API_URL); const data = await res.json(); data.forEach(row => { if (row.progress_data && row.progress_data !== "{}") db[row.agent_name] = JSON.parse(row.progress_data); }); } catch (e) {}
        }

        async function toggleTopic(key, paperKey, chName) {
            db[activeAgent][key] = !db[activeAgent][key];
            document.getElementById('overall-prog').innerText = "MISSION: " + getOverall(activeAgent) + "%";
            await fetch(`${API_URL}/agent_name/${activeAgent}`, { method: 'PATCH', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ "progress_data": JSON.stringify(db[activeAgent]) }) });
            checkArchiveAvailability(paperKey, chName);
        }

        function checkArchiveAvailability(pk, chName) {
            const prog = getChProgress(activeAgent, pk, chName);
            const btn = document.getElementById(`up-${pk}-${chName.replace(/\s/g, '')}`);
            if (btn) btn.style.display = (prog === 100) ? 'block' : 'none';
        }

        async function archiveChapter(pk, chName) {
            const input = document.createElement('input'); input.type = 'file'; input.multiple = true; input.accept = 'image/*';
            input.onchange = async (e) => {
                const files = Array.from(e.target.files);
                const btn = document.getElementById(`up-${pk}-${chName.replace(/\s/g, '')}`);
                btn.innerText = "ZIPPING..."; btn.style.opacity = "0.5";
                const fileData = await Promise.all(files.map(file => new Promise(res => { const r = new FileReader(); r.onload = ev => res({ data: ev.target.result.split(',')[1], type: file.type }); r.readAsDataURL(file); })));
                await fetch(DRIVE_SCRIPT_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify({ agent: activeAgent, paper: SYLLABUS[pk].title, chapter: chName, files: fileData }) });
                btn.innerText = "ARCHIVED"; btn.style.background = "var(--ch-green)";
            };
            input.click();
        }

        function getChProgress(name, pk, chName) {
            let t = 0, d = 0;
            SYLLABUS[pk].sections.forEach(s => s.chapters.filter(c => c.name === chName).forEach(c => c.topics.forEach(tp => { t++; if (db[name][pk+c.name+tp]) d++; })));
            return Math.round((d/t)*100) || 0;
        }

        function getProgress(name, pk) {
            let t = 0, d = 0; SYLLABUS[pk].sections.forEach(s => s.chapters.forEach(c => c.topics.forEach(tp => { t++; if (db[name][pk+c.name+tp]) d++; })));
            return (d/t)*100 || 0;
        }

        function getOverall(n) { return Math.round((['p1','p2','p3','p4'].reduce((a,p) => a + getProgress(n,p), 0))/4); }

        function showView(vid, el) {
            const vp = document.getElementById('viewport'); vp.innerHTML = "";
            document.querySelectorAll('.nav-link').forEach(n => n.classList.remove('active'));
            if(el) el.classList.add('active');

            if (vid === 'home') {
                vp.innerHTML = `<h2 style="color:var(--p3-cyan); font-family:'Orbitron'; font-size:1.1rem; margin-bottom:20px">SQUAD ANALYTICS</h2>`;
                
                // Bar Chart
                let chartHTML = `<div class="chart-container"><div class="y-axis"><span>100%</span><span>50%</span><span>0%</span></div>`;
                Object.values(AGENTS).forEach(name => {
                    const ov = getOverall(name);
                    chartHTML += `<div class="bar-wrapper"><span class="bar-val">${ov}%</span><div class="bar-pillar" style="height:${ov * 1.5}px"></div><span class="bar-label">${name.split(' ')[0]}</span></div>`;
                });
                chartHTML += `</div>`;
                
                // Scrollable Pie Charts
                let pieHTML = `<div class="pie-scroll-container">`;
                Object.values(AGENTS).forEach(name => {
                    const p1 = getProgress(name,'p1'), p2 = getProgress(name,'p2'), p3 = getProgress(name,'p3'), p4 = getProgress(name,'p4'), ov = getOverall(name);
                    pieHTML += `
                        <div class="pie-card">
                            <div class="multi-pie" style="background: conic-gradient(var(--p1-red) 0% ${p1*0.25}%, #222 ${p1*0.25}% 25%, var(--p2-orange) 25% ${25+p2*0.25}%, #222 ${25+p2*0.25}% 50%, var(--p3-cyan) 50% ${50+p3*0.25}%, #222 ${50+p3*0.25}% 75%, var(--p4-purple) 75% ${75+p4*0.25}%, #222 ${75+p4*0.25}% 100%)">
                                <div class="pie-val">${ov}%</div>
                            </div>
                            <div class="pie-label">${name.split(' ')[0]}</div>
                        </div>`;
                });
                pieHTML += `</div>`;
                
                vp.innerHTML += chartHTML + pieHTML;

                Object.values(AGENTS).forEach(name => {
                    const ov = getOverall(name);
                    const safeId = name.replace(/\s/g, '');
                    let sequentialHTML = "";
                    Object.keys(SYLLABUS).forEach(pk => {
                        const paper = SYLLABUS[pk];
                        paper.sections.forEach(s => s.chapters.forEach(ch => {
                            const chProg = getChProgress(name, pk, ch.name);
                            sequentialHTML += `<div class="comp-item" style="border-left-color:${paper.color}"><div class="comp-label">${paper.title} | ${s.name}</div><div style="display:flex; justify-content:space-between; font-size:0.75rem"><span>${ch.name}</span><span>${chProg}%</span></div><div class="comp-bar-bg"><div style="height:100%; width:${chProg}%; background:${paper.color}"></div></div></div>`;
                        }));
                    });
                    vp.innerHTML += `<div class="rank-card" onclick="const d=document.getElementById('det-${safeId}'); d.style.display=(d.style.display==='flex'?'none':'flex')"><div style="display:flex; justify-content:space-between; font-family:'Orbitron'; font-size:0.8rem"><span>${name}</span><span style="color:var(--ch-green)">${ov}%</span></div><div class="detail-view" id="det-${safeId}">${sequentialHTML}</div></div>`;
                });
            } else {
                const data = SYLLABUS[vid]; 
                vp.innerHTML = `<h1 style="color:${data.color}; font-family:'Orbitron'; font-size:1.4rem; margin:0">${data.title}</h1> <p style="color:#666; font-family:'Orbitron'; font-size:0.75rem; margin-top:5px; margin-bottom:20px">${data.subName}</p>`;
                data.sections.forEach(sec => {
                    vp.innerHTML += `<div style="background:var(--section-yellow); color:#000; padding:8px 12px; margin:15px 0; font-family:'Orbitron'; border-radius:4px; font-size:0.75rem; font-weight:bold">${sec.name}</div>`;
                    sec.chapters.forEach(ch => {
                        const safeCh = ch.name.replace(/\s/g, '');
                        const isDone = getChProgress(activeAgent, vid, ch.name) === 100;
                        let h = `<div class="ch-card"><div class="ch-head"><span>${ch.name}</span><button class="upload-btn" id="up-${vid}-${safeCh}" onclick="archiveChapter('${vid}','${ch.name}')" style="display:${isDone?'block':'none'}">ARCHIVE NOTES</button></div><div class="topic-body">`;
                        ch.topics.forEach(t => { const k = vid+ch.name+t; const c = db[activeAgent][k]?'checked':''; h += `<div class="topic-row"><input type="checkbox" onchange="toggleTopic('${k}', '${vid}', '${ch.name}')" ${c} style="accent-color:${data.color}"><span>${t}</span></div>`; });
                        vp.innerHTML += h + `</div></div>`;
                    });
                });
            }
        }
    </script>
</body>
</html>
